{% load adagiostags %}
<!DOCTYPE html>
<html>
<head profile="http://www.w3.org/2005/10/profile">
  <meta charset=utf-8 />
  <title>Québec 24x7</title>
  <basefont size="16px">
  <!--[if IE]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="{% url media path="external/bootstrap/css/bootstrap.min.css" %}" rel="stylesheet">
  <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
  <link rel="icon" 
      type="image/png" 
      href="{% url media path='img/logo.png' %}" />
  <style type="text/css">
   body {
     font-family: 'Open Sans', sans-serif;
     background: url("{% url media path="img/montreal.jpg" %}") no-repeat center top fixed; 
     background-color: black;
     -webkit-background-size: cover;
     -moz-background-size: cover;
     -o-background-size: cover;
     background-size: cover;
   }
   .transparent {
     background-color: black;
     filter: alpha(opacity=85); /* YEAH IE */
     background: rgba(0, 0, 0, 0.85);
     color: white;
   }
   #wrap {
     padding: 50px;
     width: 960px;
     margin: auto;
     margin-top: 50px;
     border: 1px solid black;
     background-color: black;
     filter: alpha(opacity=85); /* YEAH IE */
     background: rgba(0, 0, 0, 0.85);
     color: white;
   }
   a {
     color: #aaaaaa;
     text-decoration: underline;
   }
   div.box {
     margin: 20px;
     text-align: center;
     background-color:  #000000;
     border-radius: 50%;
     width: 200px;
     height: 200px;
   }

   div.box i {
      padding-top: 30px;
   }

   div.box h2 {
      color:  #ffffff;
      font-size: 23.79px; /* Approximation due to font substitution */
      font-weight: 700;
      line-height: 43.606px;
      width:200px;
      height:45px;
      position:relative;
      margin: 10px 0px;
   }

   div.box h2:before,
   div.box h2:after {
      width: 33px;
      display: block;
      content: "";
      margin: 5px auto 2px auto;
      height: 2px;
      background-color: rgba(255, 255, 255, 0.4);
   }

   div.box p.status {
      font-size: 14px; /* Approximation due to font substitution */
      font-weight: 400;
      padding-top: 10px;
   }

   .cursor-pointer {
     cursor: pointer;
   }
   div.close_box {
     font-size: 2em;
     font-weight:bold;
     text-align: right !important;
   }
   div.header {
     text-align: center;
   }
   div.header h1 {
     color:  #ffffff;
     font-size: 32px; /* Approximation due to font substitution */
     font-weight: 300;
     line-height: 18px;
   }
   .tell_me_more {
     text-align: left;
     display: none;
     margin-top: 20px;
   }
   #settings {
     top: 0;
     right: 0;
     margin: 0;
     padding: 5px;
     position: fixed;
   }
   .big-button {
     display: inline-block;
     border: 1px solid white;
     padding: 15px;
     font-size: 1.8em;
     margin-left: 10px;
     margin-right: 10px;
     height: 20px;
     width: 20px;
   }
   .map_container {
     height: 400px;
   }
   .map_outer {
     float: right;
     height: 400px;
     width: 400px;
     border: 1px solid white;
     margin-left: 40px !important;
     margin-bottom: 40px !important;
   }
   .box .hidden {
     display: none;
     text-align: left;
   }
   .box .box_hidden_content li {
     margin-bottom: 0.5em;
   }
   .outerbox_large {
     width:100%;
   }
   .invisible {
     visibility: hidden;
   }
   .border {
     border-width: 1px;
     border-style: solid;
   }
   .border-0 {
     border-color: #65c178;
   }
   .border-1 {
     border-color: #f39c12;
   }
   .border-2 {
     border-color: #e74c3c;
   }
   .border-3 {
     border-color: white;
   }
   .color-0 {
     color: #65c178;
   }
   .color-1 {
     color: #f39c12;
   }
   .color-2 {
     color: #e74c3c;
   }
   .color-3 {
     color: white;
   }
   /* work-around to not display pink zones in Firefox */
   .olImageLoadError{display: none !important;}
   
   /* work-around for a bug affecting OpenLayers+Chrome
   https://github.com/openlayers/openlayers/issues/1181#issuecomment-29693277 */
   .olTileImage {
     -webkit-backface-visibility: visible !important;
     -webkit-transform: none !important;
   }
   .olLayerGrid .olTileImage {
     -webkit-transition: none !important;
   }
  </style>
</head>
<body>
  <div id="wrap" class="transparent">
    <div class="jumbotron header">
      <h1><img src="{% url media path='img/logo.png' %}" /> QUÉBEC <span style="font-weight: 700">24X7</span> <img src="{% url media path='img/beta.png' %}" /></h1>
      <div style="margin-top: 20px;">
        <div class="big-button cursor-pointer" id="click_tell_me_more"
             onclick="$('#tell_me_more_map').hide();$('#tell_me_more_code').hide();$('#tell_me_more_info').toggle(400);">
          <i class="fa fa-info fa"></i>
        </div>
        
        <div class="tell_me_more" id="tell_me_more_info">
          <p><strong>Québec 24x7 est une application supervisant en permanence certaines métriques au Québec.</strong></p>
          <h2>Crédits</h2>
          <p>
            <ul>
              <li>Application : réalisée avec <i class="fa fa-heart"></i> par
                l'équipe Supervision de <a href="http://savoirfairelinux.com">Savoir-faire Linux</a>
                (<a href="https://github.com/matthieucan">Matthieu Caneill</a>,
                <a href="https://github.com/ReAzem">Alexandre Viau</a>,
                <a href="https://github.com/Seb-Solon">Sébastien Coavoux</a>,
                <a href="https://github.com/titilambert">Thibault Cohen</a>).</li>
              <li>Idée : grandement inspirée de <a href="http://iceland.adagios.org">
                iceland.adagios.org</a> par <a href="https://github.com/palli">@palli</a>.</li>
              <li>Cartographie : <a href="http://openstreetmap.org">OpenStreetMap</a>.</li>
              <li>Photographie de fond : "Montréal, le soir" par
                <a href="https://www.flickr.com/photos/xkristinax/7987570964">Kristina Servant</a>.</li>
            </ul>
          </p>
          <h2>Contact</h2>
          <p>
            <ul>
              <li>Courriel : <a href="mailto:supervision@savoirfairelinux.com">
                supervision@savoirfairelinux.com</a>.</li>
            </ul>
          </p>
          <h2>Hack</h2>
          <p>
            <ul>
              <li>Langages : Python, Javascript, jQuery, HTML, CSS.</li>
              <li>Supervision : Shinken, Pynag, Adagios.</li>
              <li>Serveur : Ubuntu, Apache, Docker.</li>
            </ul>
            <ul>
              <li><a href="https://github.com/savoirfairelinux/quebec-monitoring">Parcourir le code source</a>,</li>
              <li><a href="https://github.com/savoirfairelinux/quebec-monitoring/blob/master/README.md">informations pour contributeurs</a>,</li>
              <li><a href="https://github.com/savoirfairelinux/quebec-monitoring/issues/new">Rapporter un bug</a>.</li>
            </ul>
          </p>
          <h2>Partage</h2>
          <p>
            <a href="https://github.com/savoirfairelinux/quebec-monitoring"><i style="margin-right: 0.5em;" class="fa fa-3x fa-github-square"></i></a>
            <a href="https://twitter.com/share?url=http://quebec247.sflx.ca&text=I%20monitor%20Quebec%20with&via=savoirfairelinux&"><i style="margin-right: 0.5em;" class="fa fa-3x fa-twitter-square"></i></a>
            <a href="https://plus.google.com/share?url=http://quebec247.sflx.ca"><i style="margin-right: 0.5em;" class="fa fa-3x fa-google-plus-square"></i></a>
            <a href="https://www.linkedin.com/shareArticle?mini=true&url=http://quebec247.sflx.ca&title=Monitor%20Quebec&summary=&source="><i style="margin-right: 0.5em;" class="fa fa-3x fa-linkedin-square"></i></a>
          </p>
        </div>
        
        <div id="settings" class="transparent">
            <label for="checbox-reload" style="display: inline;">Auto-reload</label>
            <input type="checkbox" name="checkbox-reload" id="checkbox-reload"
                   {% if "autoreload" in request.GET %} checked="checked"{% endif %} />
        </div>
      </div>
    </div>
    <hr style="height: 1px; border: 0; border-top: 1px solid white;" />
    
    {% regroup data by groups as data_ %}
    <div class="row-fluid">
      {% for box in data_ %}
      {% with lines=box.list|dictsort:"labels" %}
      <div class="outerbox span3 color-0" id="box_{{ lines.0.description }}">
        <div class="box border border-{{ lines.0.state }} cursor-pointer">
          
          <div class="close_box hidden" onclick="hide_box('box_{{ lines.0.description }}')">
            <i class="cursor-pointer fa fa-times"></i>
          </div>
          
          <div onclick="show_box('box_{{ lines.0.description }}'); {{ lines.0.description }}_map.map.updateSize();">
            <i class="color-{{ lines.0.state }} fa {{ lines.0.icon_image }} fa-3x"></i>
            <h2>{{ lines.0.description }}</h2>
            <p class="status color-{{ lines.0.state }}">
              {% if lines.0.plugin_output == "all checks were successful." or lines.0.plugin_output|length == 0 %}
              OK
              {% elif lines.0.plugin_output|length == 1 %}
              1 problème
              {% else %}
              {{ lines.0.plugin_output|length }} problèmes
              {% endif %}
            </p>
          </div>
          <div class="hidden box_hidden_content" id="">
            {% if "map" in lines.0.labels %}
              <div class="map_outer">
                <div class="map_container" id="map_{{ lines.0.description }}"></div>
              </div>
            {% endif %}
            {% if lines.0.notes_url %}
              <div style="margin-bottom: 1em;">
                Source : {% autoescape off %}{{ lines.0.notes_url }}{% endautoescape %}
              </div>
            {% endif %}
            <div style="margin-bottom: 1em;">
              <strong>{% autoescape off %}{{ lines.0.notes }}{% endautoescape %}</strong>
            </div>
            
            <ul>
            {% for line in lines|slice:"1:" %}
              <li>
                <span class="color-{{ line.state }}">
                  {% if line.action_url %}
                    <a href="{{ line.action_url }}">{{ line.display_name }}</a>
                  {% else %}
                    {{ line.display_name }}
                  {% endif %}
                  <br /><em>{{ line.plugin_output }}</em>
                </span>
              </li>
            {% endfor %}
            </ul>
            <div style="clear:both;">&nbsp;</div>
          </div>
        </div>
      </div>
      {% endwith %}
      {% if forloop.counter|divisibleby:"4" %}
        </div>
        <div class="row-fluid">
      {% endif %}
      {% endfor %}
    </div>

  </div>

  <script src="{% url media path="external/jquery/jquery-1.9.1.min.js" %}"></script>
  <script src="{% url media path="external/bootstrap/js/bootstrap.min.js" %}"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/openlayers/2.13.1/OpenLayers.js"></script>

  <script type="text/javascript">
   /* dirty hack, which manipulates GET elements in the url */
   $("#checkbox-reload").change(function() {
     if($("#checkbox-reload").is(":checked")) {
       window.location.replace(window.location.origin + window.location.pathname + "?autoreload");
     }
     else {
       window.location.replace(window.location.origin + window.location.pathname);
     }
   });
   
   var autoReload = window.setInterval(reload, 30000);
   function reload() {
     if($("#checkbox-reload").is(":checked")) {
       window.location.reload();
     }
   }
   
   function show_box(id) {
     var box = $("#" + id);
     
     if (box.hasClass("span3")) {
       $('.outerbox').hide();
       box.show();
       box[0].classList.remove("span3");
       box[0].classList.add("outerbox_large");
       $("#" + id + " .box")[0].classList.remove("cursor-pointer");
       $("#" + id + " .hidden").fadeIn(600);
       $("#" + id + " .hidden")[0].classList.remove("invisible");
     }
   }
   
   function hide_box(id) {
     var box = $("#" + id);
     
     if (!(box.hasClass("span3"))) {
       $("#" + id + " .hidden")[0].classList.add("invisible");
       $("#" + id + " .hidden").hide();
       $("#" + id + " .box")[0].classList.add("cursor-pointer");
       box[0].classList.remove("outerbox_large");
       box[0].classList.add("span3");
       $('.outerbox').show();
     }  
   }
   
   var fromProjection = new OpenLayers.Projection("EPSG:4326");
   var toProjection   = new OpenLayers.Projection("EPSG:900913");
   
   function create_map() {
     var position       = new OpenLayers.LonLat(-7864933.6056233 ,7223393.3176719);//.transform(new OpenLayers.Projection('EPSG:4326'), new OpenLayers.Projection('EPSG:3857'));
     var zoom           = 4;
     
     var markers = new OpenLayers.Layer.Markers("Markers");
     
     var OSMLayer = new OpenLayers.Layer.OSM('OSM Map', null, {});
     
     var map = new OpenLayers.Map({
       layers: [OSMLayer, markers],
       center: position,
       zoom: zoom,
     });
     return {map: map, markers: markers};
   }
   
   var icon_0 = new OpenLayers.Icon('{% url media path="img/marker-0.png" %}');
   var icon_1 = new OpenLayers.Icon('{% url media path="img/marker-1.png" %}');
   var icon_2 = new OpenLayers.Icon('{% url media path="img/marker-2.png" %}');
   var icon_3 = new OpenLayers.Icon('{% url media path="img/marker-3.png" %}');
    
   {% for box in data_ %}
   {% with lines=box.list|dictsort:"labels" %}
   {% if "map" in lines.0.labels %}
     var {{ lines.0.description }}_map = create_map();
     {% for line in lines|slice:"1:" %}
       {% with loc=line.icon_image_alt %}
         {% if loc %}
           {{ lines.0.description }}_map.markers.addMarker(new OpenLayers.Marker(
                           new OpenLayers.LonLat({{ loc }}).transform(fromProjection, toProjection),
                           icon_{{ line.state }}.clone()));
         {% endif %}
       {% endwith %}
     {% endfor %}
     
     {{ lines.0.description }}_map.map.render("map_{{ lines.0.description }}");
   {% endif %}
   {% endwith %}
   {% endfor %}
  </script>
  <script>
    if (window.location.href.indexOf('geocities') > -1) {
     $('head > style').remove();
     $('head').append('<link href="http://code.divshot.com/geo-bootstrap/swatch/bootstrap.min.css" rel="stylesheet">');
     $('.box .hidden').css('display', 'none');
     $('.tell_me_more').css('display', 'none');
   }
  </script>
  
<!-- Piwik -->
<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u=(("https:" == document.location.protocol) ? "https" : "http") + "://quebec247.sflx.ca/piwik/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', 1]);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0]; g.type='text/javascript';
    g.defer=true; g.async=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<noscript><p><img src="http://quebec247.sflx.ca/piwik/piwik.php?idsite=1" style="border:0;" alt="" /></p></noscript>
<!-- End Piwik Code -->
</body>
</html>
